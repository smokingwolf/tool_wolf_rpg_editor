<!doctype html>
<html lang="ja">
<HEAD>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<TITLE>セーブ・ロード操作</TITLE><LINK rel="stylesheet" href="style.css">
</HEAD>
<BODY>
<P><BR>
イベントコマンド　<B><FONT size="+1">【セーブ・ロード操作】</FONT></B><BR>
<BR>
　データのセーブやロードに関する処理を行います。 セーブデータの一部だけ操作することも可能です。<BR>
<BR>
<IMG src="Ev_file.png" border="0"><BR>
<BR>
<B><FONT size="+1">【基本的な説明】</FONT></B><BR>
・並列実行されるイベント中で「ロード」を行うことは出来ません。エラーが出て処理が中断されますので注意して下さい。（強制終了する可能性があるため）<BR>
・「（セーブデータの）変数・文字列の読み込み」では「イベントのセルフ変数」や「XY配列」を読み込むことはできません。<BR>
<BR>
<BR>
<B><FONT size="+1">【各機能の説明】</FONT></B><BR>
<BR>
<B>[保存・読込（セーブ/ロード）]</B><BR>
　セーブデータを書き込んだり、読み込んだりするコマンドです。セーブデータのファイル名は、たとえばセーブデータ番号1番の場合は、<BR>
　　「<B>Save/SaveData01.sav</B>」<BR>
として保存されます。セーブデータ番号には変数（例：2000000[通常変数0番]など）を指定することができます。<BR>
　<FONT color="#ff0000">なお読み込むセーブデータが存在しない場合は、そのまま次のイベントコマンドを実行します。</FONT>セーブデータが存在する場合は、イベントを即中断してセーブされた状態からゲームを再開します。<BR>
<BR>
<BR>
<B>[セーブデータからの読み込み (変数・文字列)]</B><BR>
　指定したセーブデータから数値・文字列を読み込み、現在プレイしているゲームの変数へ代入します。なお、読み込むセーブデータが存在しない場合、変数なら0の値、文字列なら空白文字列が代入されます。<BR>
　余談ですが、システム変数24番（9000024：[読]ｾｰﾌﾞﾃﾞｰﾀ読込判定）はそのセーブデータが存在する場合は必ず「1」を返す変数です、このコマンドでまずこのシステム変数を読み込めば、セーブデータの有無を確認することができます。<BR>
<BR>
<BR>
<B>[セーブデータへの書き込み]</B><BR>
　指定したセーブデータに変数・文字列だけ書き込みます。<BR>
<span style="color : #999999;">　※もしセーブファイルが存在しない場合は、新たにセーブファイルを作成します。ただしその場合、保存先には</span><span style="color : #cc0000;"><b>可変DBのタイプ情報、データは一切書き込まれません</b></span><span style="color : #999999;">のでご注意下さい。マニアックな部分ですが引っかかりポイントです。<br>
　　→　もし可変DBの内容もセーブファイルに入れたい場合は最初に通常の「保存・読込」→「セーブ」を行ってください。</span><BR>
<BR>
<BR>
<B><FONT size="+1">【使用例】</FONT></B><BR>
・「保存・読込」機能はセーブが必要なゲームでは必須です。<BR>
<BR>
・「変数・文字列の読み込み」や「セーブデータへの書き込み」は、各々のセーブデータだけでは保存しきれない情報を別のファイルに保存するのに使えます。一例としては、「ゲーム全体のクリア回数を保存する」といった役割のデータを作成する際に便利です。<BR>
<BR>

<hr>
<P><B><FONT size="+1">【特殊機能　保存ファイル名を文字列変数で指定】</FONT></B><br>
<BR>
　各データ番号欄に文字列変数（3000000～）を指定すると、その文字列のデータ名でセーブデータが保存されます。たとえば文字列変数0番に「システム情報.sav」と代入してセーブデータ番号に3000000を入力して「セーブ」すると、<B>Game.exeと同じフォルダ</B>に「システム情報.sav」というファイルが保存されるようになります。<br>
　「Save/システム.sav」なら「Save」フォルダの中に作られます。<br>
<br>
<span style="color : #999999;">　※セキュリティ上の安全とWindowsのファイル仕様のため、保存先文字列に「//」「\\」「..」「./」「.\」「%」「:」「*」「?」「&quot;」「&lt;」「&gt;」「|」が含まれているとファイル書き込みできません、ご注意ください(Ver3.00以降)。</span><BR>

<hr>
<P><B><FONT size="+1">【重要な点　ロード後はイベントが実行されてない状態から再開されます】</FONT></B><br>
<BR>
　たとえイベントの途中でセーブしていた場合でも、セーブデータをロードした直後は「イベントが実行されていない状態」から再開されます。<BR>
　つまり、<B><FONT color="#ff0000">ロード後に実行中だったイベントコマンドが途中から再開されたりはしません</FONT></B>ので、注意してください。<BR>
<BR>
　変数操作の順番などを間違えると、「ボス戦イベント中にセーブしたデータをロードすると、イベントが終了した扱いになってて続きが何も起きない」といった失敗が起こったりします。<BR>
　<br>
　一方で、この仕様を利用すれば、「<b>1回だけ処理してあとは無限にウェイトし続けるだけの並列イベント</b>」などを作ることで、「<b><span style="color : #cc0000;">ロードごと(または「リセット時」や「ゲーム開始時」)に1回だけ起動するイベント</span></b>」を実現することが可能です。<br>

<hr>
<P><b><font size="+1">【変数の読込・書込時のメモリキャッシュや、ファイル書き込みタイミングについて】</font></b><br>
<br>
<b>●セーブデータはメモリにキャッシュされています</b><br>
　「変数・文字列の読み込み」あるいは「セーブデータへの書き込み」を行ったセーブデータは、初回はSSD/HDDから読み込まれますが、そのデータはメモリ内にキャッシュされ、次以降はメモリから読み込まれます。そのため、2回目以降の処理は高速化されます。<br>
　ただし新たなセーブデータによって<b>メモリのキャッシュがあふれそうになった場合</b>は、<b><span style="color : #cc0000;">自動的にメモリ内のセーブデータの全キャッシュが消去</span></b>されます（次に開いたとき、そのセーブデータが再びSSD/HDDから読み直されるだけなので、処理上は特に問題ありません）。<br>
<br>
<br>
<b>●「セーブデータへの書き込み」がファイルに反映されるのはフレームの最後です</b><br>
　「セーブデータへの書き込み」処理を行った際、実際にその変更が反映されてセーブデータのファイルが保存され直すタイミングは<b>そのフレーム（1/60秒）の最後</b>です。<br>
　そのため、「セーブデータへの書き込み」は<b>1フレーム中にまとめて1ファイルへの書き込みを行うのがおすすめ</b>です。何フレームにも分割して書き込むと、そのたびにファイルの保存し直しが発生してしまうからです。<br>
<br>
<br>
<b>●巨大なデータを含むセーブデータの場合、同時に複数のセーブにアクセスせずウェイトを入れてください。</b><br>
　<b><span style="color : #cc0000;">膨大なデータ数の可変DBがあったり、巨大なXY配列が保存されている</span></b>などの「巨大なデータ」が保存されているセーブデータが複数ある場合、「<b>セーブデータへの書き込み</b>」で<b>「1フレーム中に複数のセーブデータに書き込み」</b>すると<b><span style="color : #cc0000;">メモリがあふれてエラーが発生し、書き込み処理がキャンセルされる</span></b>場合があります。<br>
　その場合は、なるべく<b>「1フレーム中には1ファイルだけに書き込み」</b>、処理後には<b>「1フレームのウェイトを入れて」</b>次のセーブデータへの書き込み処理を行うようにしてみてください。<br>
<BR>
　ただ、1フレーム中に1つのセーブデータへの書き込みをするようにしても安定しない場合はありますので、どうしても安定しない場合は、<b>ゲーム中には他のセーブデータにアクセスしないようにする</b>など仕様の調整もご検討ください。たとえば「セーブデータをロードしてゲームを始めた後は、そのプレイ内からは他のセーブデータにセーブ・ロードできないようにする」といった具合です。<br>
<BR>
　
</BODY>
</HTML>
