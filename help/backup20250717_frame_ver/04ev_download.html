<!doctype html>
<html lang="ja">
<HEAD>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<TITLE>ダウンロード</TITLE>
<LINK rel="stylesheet" href="style.css">
</HEAD>
<BODY>
<P><BR>イベントコマンド　<B><FONT 
size=+1>【ダウンロード】</FONT></B><BR>
<BR>
　インターネット上からファイルをダウンロードしたり、CGIを呼び出したり、POST送信したりできます。<BR>
<BR>
<BR>
<img src="04ev_download1.png" border="0" width="592" height="335"><BR>
<BR>
<B><FONT size="+1">【基本的な説明】</FONT></B><BR>
<BR>
・このコマンドを使用するためには、「エディターオプション」の「<B>上級者向けコマンドを使用する</B>」チェックを入れる必要があります。<BR>
<br>
・各テキスト欄には全て、通常の文字列の他に特殊文字（例：\s[?]など）を使用することができます。<BR>
<br>
・無自覚にサーバアタックをしてしまうことを防ぐため、1分以内に連続して接続すると、次の接続までの数秒間のウェイトが入るようになっています。<br>
<br>
・「<b>プレイヤー名</b>」などプレイヤーが<b><span style="color : #ff0000;">自由にキーボード入力できる内容</span></b>を送信する場合は、<b><span style="color : #ff0000;">よく分からなくても半角「&amp;」や「=」を【文字列操作】で「全て消去」しておく（あるいは全角「＆」や全角「=」に変換する）のがセキュリティ的に安全</span></b>です。<br>
<br>
<BR>
<BR>
<B><FONT size="+1">【各部の説明】</FONT></B><BR>
<BR>
<B>１．URL</B><BR>
　接続先のURLを指定することができます。<br>
<br>
　・<b>URLエンコードして送信[ｸｴﾘのみ] </b>： URLの 「? 以降の文字列」がURLエンコードされて接続されます。日本語文字が「あ」→「%E3%81%82」のように変換されます。またこのURLエンコードは、アルファベット、数字、記号の「*」「.」「-」「_」「&amp;」「=」のみ<b>変換しません</b>。<br>
　<span style="font-size : 80%;">（クエリーをURLエンコードする場合、「&amp;」や「=」が違う文字になっているとフォームデータ受信の方法が使えなくなるため。基本的にこれで問題はないと思います。</span><span style="font-size : 80%;
	color : #cc0000;
"><b>プレイヤー側で半角「&amp;」や半角「=」が使われないよう注意してください</b></span><span style="font-size : 80%;">）</span><br>
　・<b>SJIS変換する</b>： 通常「UTF-8」文字コードとして送信されるURLが、SJIS（他の言語ならそれぞれのマルチバイト文字コード）に変換されます。<br>
<br>
<br>
<BR>
<B>2．POST送信</B><BR>
　指定URLのサーバプログラムにPOST送信できます。<br>
　POST受信するためのサーバプログラムをサーバ上に実装する必要があります。<BR>
<br>
　・<b>URLエンコードして送信 </b>： 送信内容がURLエンコードされて接続されます。「URL」のものと同様です。<br>
　・<b>SJIS変換する</b>： 通常「UTF-8」文字コードとして送信されるURLが、SJIS（他の言語ならそれぞれのマルチバイト文字コード）に変換されます。<br>
<br>
<br>
<BR>
<B>3．保存フォルダ</B><BR>
　ダウンロードしたファイルの保存先です。EXEがあるフォルダからの相対フォルダを指定します（「Data/」など）<BR>
　→　「/」で終わる場合、URL側で指定されたファイル名のままフォルダ内へファイル保存します。<br>
　→　最後が「/」でない場合（最後にファイル名が来る場合）は、ダウンロードしたファイルをそのファイル名に変更して保存します。<br>
<br>　<span style="color : #999999;">※「保存フォルダ」の文字列に「//」「\\」「..」「./」「.\」「%」「:」「*」「?」「&quot;」「&lt;」「&gt;」「|」が含まれているとエラーが出ますので注意してください(Ver3.00より)</span><BR>
<br>
<BR>
<B>4．格納先の文字列変数</B><BR>
　ダウンロードした内容を文字列変数に格納できます。<br>
<span style="color : #999999;">　[P]コマンドについてはこちらをご覧ください→</span> <b><a href="04ev_download_pro.html" target="B" class="blue">[P]</a></b><br>
<br>
<br>
　・<b>SJIS変換で受信</b>： 通常受け取った文字列は「UTF-8」文字コードとして認識しますが、これをオンにするとSJIS（あるいは言語別のマルチバイト）文字コードとして認識されます。<br>
<br>
<B>　・ダウンロード完了までウェイト</B>： オンにすると、ダウンロード完了までイベント処理を停止させます。 <HR>
<P><B>【裏技1】　オンラインアップデート用の隠し機能</B><BR>
<BR>
　『<B><span style="color : #ff0000;">Data/_NetDownloadData</span></B>』を保存フォルダとして設定すると、そのフォルダ内に入れたファイルが<BR>
　ゲームの次回起動時に、フォルダ構造を維持したまま『<B>Data</B>』フォルダ内に移動します<BR>
　（すでにファイルがある場合は上書きされます）。<BR>
<BR>
　これで何ができるかというと、たとえばプレイ中には上書きできない『<B>Basicdata.wolf</B>』ファイルなどの<BR>
　更新が可能となります。その際、ゲームの再起動はプレイヤーの手動で行ってもらうよう、うながしてください。</P>
<hr>
<p><b>【裏技2】　通信の強制切断</b><br>
<br>
　実は<b><span style="color : #ff0000;">システム変数48「[読]ﾈｯﾄ/状態 -1失敗 0通信中 1終了」</span></b>に「<b><span style="color : #ff0000;">-1</span></b>」を代入すると、通信を強制的に中断させることができます。<br>
　ただし変なファイルが残ったりする場合もあるので、あまり推奨されません。</p>
<hr>
<P><b>【裏技3】　POST送信時のContent-Typeを変更する</b><br>
<br>
　「POST送信」文のどこでも「<b>&lt;&lt;CONTENT&gt;&gt;<span style="color : #cc0000;">～～</span>&lt;&lt;CONTENT_END&gt;&gt;</b>」と入れると<br>
　送信時のContent-Typeヘッダを<span style="color : #cc0000;"><b>～～</b></span>部分で上書きすることができます。<br>
　相手側のサービスの仕様に合わせてContent-Typeを変えて送信する必要がある場合にご利用ください。<br>
<BR>
<b>【入力例】</b><br>
　&lt;&lt;CONTENT&gt;&gt;application/json&lt;&lt;CONTENT_END&gt;&gt;～ここにPOSTしたい内容～<br>
　　→　こう入力すると「Content-Type」が「application/json」として送信されます。<br>
<br>
<span style="font-size : 80%;">　※デフォルトでは「&lt;&lt;CONTENT&gt;&gt;application/x-www-form-urlencoded&lt;&lt;CONTENT_END&gt;&gt;」が入っているのと同じ処理が行われています。</span><br>
<br>
<span style="font-size : 80%;">　※「&lt;&lt;CONTENT&gt;&gt;～&lt;&lt;CONTENT_END&gt;&gt;」の部分は送信時に削除されます。</span><br>
</P>
<hr>
<p><b>【裏技4】　http(s)://localhost　への接続に限り、連続接続ウェイトは増加しない<br>
　<br>
</b>　【ダウンロード】機能は1分以内に連続して接続を行うと待ち時間が増加していきますが、<br>
　接続先URLが自分である「<b>http://localhost:～</b>」や「<b>https://localhost/～</b>」などから始まる場合に限り<br>
　連続接続時のウェイトが増加しないようになっています（Ver3.106以降）。<br>
<br>
　なお、「localhost」と全く同じ意味ですが「http://127.0.0.1」という表記では<br>
　この効果は適用されませんのでご注意ください。<br>
　その場合は、「<b>127.0.0.1</b>」の部分を「<b>localhost</b>」に書き替えてご利用ください。<br>
</p>
<hr>
<P><BR>
<BR>




</BODY>
</HTML>