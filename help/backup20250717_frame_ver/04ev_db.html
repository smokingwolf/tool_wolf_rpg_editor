<!doctype html>
<html lang="ja">
<HEAD>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="GENERATOR" content="JustSystems Homepage Builder Version 22.0.5.0 for Windows">
<TITLE>DB（データベース）操作</TITLE>
<LINK rel="stylesheet" href="style.css">
</HEAD>
<BODY>
<P><BR>イベントコマンド　<B><FONT size="+1">【DB（データベース）操作】</FONT></B><BR>
<BR>
　各「データベース」や「XY配列」から値を読み込んだり、値を変更したり、データ操作したりすることができます。<BR>
<BR>
<IMG src="Ev_db.png" border="0"><BR>
<br>
<br>
<b>※【前提知識】　「DB」と「XY配列」について</b><br>
　・<b>データベース</b>：タイプごとに、「<b>項目</b>」として「変数」か「文字列」のどちらかを入力できるボックスを最大100個並べて構成することが可能な「データの入れ物」です。あらかじめ「（可変/ユーザ/システム）データベースウィンドウ」で項目を設定しておく必要があります。「<b>データ番号</b>」は0～9999、「<b>項目番号</b>」は0～99の範囲で指定できます。<br>
<br>
　・<b>XY配列</b>：数値のみ格納できる二次元配列で、DBの「タイプ、データ番号、項目番号」と同じく、「<b>配列番号/名前</b>」「<b>X列(データ番号)</b>」「<b>Y列(項目番号)</b>」の3パラメータで指定します。「<b>配列番号/名前</b>」はメモリ量の限り無制限に使うことができ、「<b>X列・Y列</b>」は0～9999の範囲で指定可能です。<br>
<br>
<br>
<BR>
<B><FONT size="+1">【機能の説明】</FONT></B><BR>
<BR>
<B>１．「可変DB / システムDB / ユーザDB / XY配列」　ボタン</B> ： <B>「DBへ代入 / 変数に代入」</B>ボタン<BR>
　どのデータベースに対して処理を行うかを選択するボタンです。<br>
　なお、「<B>DBへ代入</B>」が可能なのは「<b>可変DB</b>」と「<b>XY配列</b>」のみで、それ以外のDBを扱うときは常に「<B>変数に代入</B>」が選択されます。<BR>
<br>
　<b>※裏技</b>：<b><span style="color : #cc0000;">Ctrl</span></b>を押しながら上記ボタンでデータベースを変更すると、<b><span style="color : #cc0000;">「名前」を維持したまま</span></b>のDB切り替えが可能です (Ver3.593より)<br>
<br>
<BR>
<BR>
<B>２．データベースの対象</B><BR>
　処理したい（または読み込みたい）データベースの<B>タイプ番号・データ番号・項目番号</B>（XY配列なら「<b>配列番号･名前」「X列」「Y列」</b>）を指定します。この欄には2000000（通常変数0番）などの変数も指定可能です。<BR>
<br>
<b>【可変・ユーザ・システムDBを選んでいた場合】</b><BR>
　<b>【変数に代入】</b>を選んでいたとき<br>
　　→　タイプ番号を入れて「<B>データ数取得</B>」「<B>項目数取得</B>」が取得可能です。<br>
　　→　指定した「<b>番号</b>」の「<B>タイプ名取得[文字]</B>」「<B>データ名取得[文字]</B>」「<B>項目名取得[文字]</B>」。<br>
　　　　または指定した「<B>名前</B>」の「<B>タイプ番号取得[数]</B>」「<B>データ番号取得[数値]</B>」「<B>項目番号取得[数値]</B>」を行うことができます。<BR>
<BR>
<b>　【DBへ代入】</b>を選んでいたとき<br>
　　→ タイプ番号を入れて「<B>全データ初期化</B>」が可能です。その可変DBタイプが全初期化されます。<br>
　　→ タイプ番号とデータ番号を指定して「<B>全内容初期化</B>」をすることで特定のデータのみを初期化することもできます。なお、初期化する数値は、「<A href="05dbtype.html">タイプの内容設定</A>」指定された初期値になります（ゲーム開始時の値とは異なります）。<BR>
<BR>
　※また、各入力欄の「<B>名前</B>」にチェックを入れると、データベースのタイプ/データ/項目の名前で呼び出すことができます。可変DBでデータIDの設定方法に「最初の文字列データ」を設定している場合、途中で書き換えられても指定できるのはゲーム開始時の文字列になります。なお、特殊文字による変数呼び出しはできませんので注意してください(例えば、\cself[5]と入力しても、コモンセルフ5の中身の文字列ではなく、&quot;\cself[5]&quot;という項目名が検索されます)。<BR>
<br>
<br>
<br>
<b>【XY配列を選んでいた場合】</b><br>
　→ 「<b>配列番号/名前</b>」の「<b>名前</b>」チェックを入れると、XY配列を「<b>名前</b>」で呼び出しできます。「<b>名前</b>」チェックが入ってない場合はXY配列を「<b>番号</b>」で呼び出しできます。<br>
　→ 「<b>番号</b>」呼び出しで指定する方が処理は高速になります。「<b>名前</b>」呼び出しは多少処理速度を犠牲にしますが、可読性が高くなります。<br>
　<span style="color : #999999;">※この「番号」呼び出しと「名前」呼び出しの2つの配列は【別の配列】に保存されているので、「名前」モードで「数字」を入れても「番号」呼び出し配列は呼び出せません。<br>
　※「名前」呼び出しで末尾に&lt;S&gt;が付く名前は使用できません（将来作られる処理のために予約されています）。</span><br>
　<br>
　<b>【DBへ代入】</b>を選んでいたとき<br>
　　→ 「<b>配列番号/名前</b>」を指定して「<b>配列を削除</b>」するとその番号/名前の配列を削除できます。<br>
　　→　「<b>指定X列を0リセット</b>」をすると、指定したX1列のY列すべての値を0にします。<br>
<br>
　<b>【変数に代入】</b>を選んでいたとき<br>
　　→ 「<b>データ数取得[数値]</b>」「<b>項目数取得[数値]</b>」を行うことができます。<br>
　<br>
<br>
<BR>
<BR>
<B>３．処理変数</B><BR>
　読み込みたい（または処理したい）変数を指定します。「＝」などの演算子の意味については「<A href="04ev_calc.html">計算式の説明</A>」を参照してください<BR>
<br>
<BR>
<br>
<B>4．データ操作　「新データ挿入↑」「データ抜き取り↑」「データコピー↑」「データソート↑」</B><BR>
　ゲーム中、データベースの空データを特定個数だけ「<b>挿入</b>」したり、特定個数だけ「<b>抜き取ったり</b>」、特定データの全項目を特定番号のデータに「<b>コピー</b>」したり、「<b>ソート（並び変え）</b>」することができます。<br>
<br>
　「<b>挿入</b>」「<b>抜き取り</b>」すると操作した場所以降のデータ番号もずれます。
<table border="0">
  <tbody>
    <tr>
      <td>
      <table border="0">
  <tbody>
    <tr>
            <td style="
	text-align : center;
	width : 29px;
">&nbsp;</td>
            <td style="
	text-align : center;
	width : 15px;
"><b>挿<br>
            入<br>
            の<br>
            例</b></td>
            <td style="width : 25px;">
      <table border="1">
  <tbody>
    <tr>
            <td nowrap style="text-align : center;"><b>データ</b><br>
            ID0 : 4<br>
            ID1 : 2<br>
            ID2 : 9&nbsp;<br>
            ID3 : 6</td>
            <td nowrap style="text-align : center;">データ番号<br>
            <b>[1]</b>の<br>
            直前に<br>
            <b>[2]</b>個挿入<br>
                  <b><span style="font-size : 150%;">→&nbsp;</span></b></td>
            <td nowrap>&nbsp;<b>データ</b><br>
            ID0 : 4<br>
            <b><span style="color : #cc0000;">ID1 : 0<br>
            ID2 : 0</span></b><br>
            ID3 : 2<br>
            ID4 : 9&nbsp;<br>
            ID5 : 6</td>
    </tr>
  </tbody>
</table>
      </td>
    </tr>
  </tbody>
</table>
      </td>
      <td style="width : 39px;"></td>
      <td style="width : 195px;">
      <table border="0">
  <tbody>
    <tr>
            <td style="width : 22px;
	text-align : center;
	vertical-align : middle;
"><b>抜<br>
            き<br>
            取<br>
            り<br>
            の<br>
            例</b></td>
            <td style="width : 25px;">
      <table border="1">
  <tbody>
    <tr>
            <td nowrap style="text-align : center;"><b>データ</b><br>
            ID0 : 4<br>
            ID1 : 2<br>
                  <span style="color : #009900;"><b>ID2 : 9<br>
                  ID3 : 6</b></span><br>
                  ID4 : 3</td>
            <td nowrap style="text-align : center;">データ番号<br>
            <b>[2]</b>を含め<br>
            <b>[2]</b>個<br>
                  抜き取り<br>
                  <b><span style="font-size : 150%;">→&nbsp;</span></b></td>
                  <td nowrap style="text-align : center;"><b>データ</b><br>
            ID0 : 4<br>
            ID1 : 2<br>
                  ID2 : 3</td>
                </tr>
  </tbody>
</table>
      </td>
    </tr>
  </tbody>
</table>
      </td>
    </tr>
  </tbody>
</table>
<P>　「<b>ソート</b>」では、指定した範囲のデータを、指定した「<b>項目</b>」の大小にしたがって「<b>昇順[小→大]</b>」か「<b>降順[大→小]</b>」に並び変えることができます。数値基準だけでなく文字列のソートも可能です（文字列の並び変え順はUTF-8の文字コード順になると思われます）。<br>
<BR>
<br>
<BR>
<B>5．CSV入出力「DBへ入力↑」「CSVへ保存→」　</B><BR>
　ゲーム中、データベースのデータ内容をCSVファイルへ保存したり、CSVファイルからDBへのデータ読み込みが可能です（CSVファイル＝カンマ区切りのテキストデータファイル）。<br>
　通常は「可変DB」へ読み込ませる想定ですが、「ユーザDB」を上書きすることも可能です。ただし「データ名」を「名前で呼出」してる場合は挙動がおかしくなります。
データ名とデータ番号のひも付けは、高速化のために、ゲーム開始時に一括して行っているので、途中で変更しても反映されないためです。<br>
　「読込ファイル」欄には特殊文字の\s[?]や\cself[?]などが使用可能です。<BR>
<br>
　<span style="color : #999999;">※対象ファイルのアドレスとして「//」「\\」「..」「./」「.\」「%」「:」「*」「?」「&quot;」「&lt;」「&gt;」「|」が含まれているとエラーが出ますので注意してください(Ver3.00より)。</span><BR>
　<br>

<hr>
<P>
<b><span style="font-size : 120%;">【ある「番号/名前」のXY配列が存在するかを調べる方法はある？】</span></b> (Ver3.50より) 　<br>
<br>
　直接のXY配列の存在確認はできませんが、その配列「番号」や「名前」を指定して「<span style="font-size : 120%;
	color : #cc0000;
"><b>X列の数</b></span>」を取得すれば「0」（まだ何も格納されていない=作られていない）か「1以上」かで実質的な配列の存在確認が可能です。<br>
　
<hr>
<P><b><span style="font-size : 120%;">【「データ番号」を「名前」指定する際の仕様の変化】</span></b> (Ver3.566より) 　<br>
　「<b>データ番号</b>」を「<b>名前</b>」で指定する方法ですが、対象タイプの「<b>データ名</b>」として「<b>最初の文字列を使用する</b>」が設定されているタイプであった場合、ゲーム中に「<b>1つめの文字列項目</b>」の名前が変更されたら「<b><span style="color : #cc0000;">変わった後の最新のデータ名</span></b>」で判定されるようになりました（Ver3.566から）。<br><br>　Ver3.565以前は「<b><span style="color : #cc0000;">ゲーム起動時点のデータ名</span></b>」をもとに対応する番号を取得していたので、エディター内で名前指定しても問題が起きないようになっていましたが、今後は<b><span style="color : #cc0000;">「データ名」を「名前」指定で呼び出していてゲーム中にデータ名が変わった場合、読み込めなくなる場合があります</span></b>。<br>　たとえばサンプルゲームのタイプ「キャラクター」のデータ名「<b>ヒーローさん</b>」の情報を呼び出していた場合、「<b>ヒーローさん</b>」が「<b>スーパーヒーローさん</b>」に名前が変わってしまうとエラーが起きるのです。この点には注意してください。<br>　→　もしこの仕様を、昔の「<b>【起動時のデータ名】に基づいてのみデータ名判定を行う</b>」ようにしたい場合は、<a href="02ver_ajust.html" target="B">「<b>ゲーム基本設定</b>」の「<b>Game.exe動作バージョン調整</b>」</a>を「<b>旧Ver3.50以前</b>」に変更してください。<br><br><br>　なお、ゲーム中の動的なデータ名の変更は<b>「可変DB」のみ</b>対応しています。<br>　「ユーザDB」や「システムDB」も裏技で「データ名」を変更することはできますが、処理高速化のため、<b>「ユーザDB」や「システムDB」においては「ゲーム起動時のデータ名」がそのまま使われます。</b><br>
<hr>
<P><b><span style="font-size : 120%;">【「データ番号」/「項目番号」指定で限界オーバーした場合】</span></b><br>
<br>
　データベースの「データ番号」は0～9999まで、「項目番号」は0～99の範囲までしか使えませんが、実は「<b><span style="color : #cc0000;">DBへ代入</span></b>」と「<b><span style="color : #cc0000;">変数に代入</span></b>」の2つの機能の場合のみ、その数をオーバーした値を指定することができます。<br>
<br>
　●たとえばデータ番号を「10000」にすると「次のタイプのDB」を対象にします。<br>
　　「<b><span style="color : #cc0000;">タイプ20</span>の</b><span style="color : #cc0000;"><b>データ番号10000</b></span>」は、実際には「<b><span style="color : #cc0000;">タイプ21</span>の<span style="color : #cc0000;">データ番号0</span></b>」として扱われるのです。<br>
<br>
　●「項目番号」も同様で「<b>タイプ20の<span style="color : #cc0000;">データ番号2</span>の<span style="color : #cc0000;">項目番号200</span></b>」に指定した場合は「<b>タイプ20の<span style="color : #cc0000;">データ番号4</span>(+2されている)の<span style="color : #cc0000;">項目0</span></b>」扱いになります。<br>
<br>
　→　これらは「タイプをまたいで10000個以上のデータを扱ったり」、「データをまたいで100個以上の項目を扱う状況」のために用意されている仕様です。<br>
　　　単純に「データ番号が限界を越えると次のタイプに移る」「項目番号が限界を越えると次のデータに移る」というだけなので、必要に応じてうまく活用してみてください。<br>
　　　（たとえば同じタイプ3つ分をタイプ20～22に並べて使えば、「タイプ20の0～29999番まで」の「データ」を保存することもできます）<br>
　　　　<br>
<br>
<b>【XY配列の場合】</b><br>
　XY配列でも同様に、「<b><span style="color : #cc0000;">DBへ代入</span></b>」と「<b><span style="color : #cc0000;">変数に代入</span></b>」の使用中のみ、「<b><span style="color : #cc0000;">Y列</span></b>」の指定が<b><span style="color : #cc0000;">10000</span></b>を超えるたびに「<b><span style="color : #cc0000;">X列</span></b>」の値が<b><span style="color : #cc0000;">+1</span></b>されます。<br>
　なお「<b><span style="color : #cc0000;">X列</span></b>」の値が<b><span style="color : #cc0000;">10000</span></b>を超えるとどんな場合でもエラーになります。<br>

<hr>
<P><b><span style="font-size : 120%;">【TIPS　DB操作のコモンイベント内での処理速度】</span></b><br>
　DB操作コマンドは以下の条件を満たした場合だけ処理が大幅に高速化されます。<br>
<br>
<b>【「可変/ユーザ/システムDB」を対象にしている場合の高速化条件】</b><br>
　・コモンイベント内にコマンド入力し、「テストプレイ時ならValWatch機能を使わない」（非テストプレイ時ならどちらでも問題なし）<br>
　・「タイプ」と「項目」を固定にする　→　「変数」さえ使わなければ、「数値」指定でも「名前」呼び出し指定でも可。<br>
　　（「データ」は変数が使用可能）<br>
　・DB側は「数値」の項目を対象にし、下部欄も「数値（変数）」を使用する（「文字列」の項目では高速化されません）<br>
　・コマンドは「DBへ代入」か「変数に代入」のどちらかにする<br>
　・演算子はどれでも可<br>
　・DB操作ウィンドウ内のチェックボックスに何もチェックを入れない<br>
<br>
<br>
<b>【「XY配列」を対象にしている場合の高速化条件】</b><br>
　・コモンイベント内にコマンド入力し、「テストプレイ時ならValWatch機能を使わない」（非テストプレイ時ならどちらでも問題なし）<br>
　・コマンドは「DBへ代入」か「変数に代入」のどちらかにする<br>
　・「XY配列番号/名前」は「番号」呼び出しでも「名前」呼び出しでもどちらでもOK<br>
　・演算子を「=」「+=」「-=」「*=」「/=」のいずれかにする<br>
　・下部欄は「数値（変数）」を使用する（「文字列」側では高速化されません）<br>
　・DB操作ウィンドウ内のチェックボックスに何もチェックを入れない<br>
<br>

<hr>
<P><br>

</BODY>
</HTML>