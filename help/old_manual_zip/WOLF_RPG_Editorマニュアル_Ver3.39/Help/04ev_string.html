<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="GENERATOR" content="JustSystems Homepage Builder Version 22.0.5.0 for Windows">
<TITLE>文字列操作</TITLE><LINK rel="stylesheet" href="style.css">
</HEAD>
<BODY>
<P><BR>イベントコマンド　<B><FONT size=+1>【文字列操作】</FONT></B><BR>
<BR>
　文字列変数を操作したり、キーボードからの文字入力を受け付けるコマンドです。<BR>
<BR>
<IMG src="Ev_string.png" border="0"><BR>
<BR>
<BR>
<B><FONT size=+1>【各部の説明】</FONT></B><BR>
<BR>
<BR>
<B>１．代入先の指定</B><BR>
　代入先の文字列変数を選択します。<BR>
　「代入先を変数で指定」する際は、通常/予備変数に3000000（文字列変数）以上の値を入れて使用してください。<BR>
<BR>
<BR>
<BR>
<B>2.代入方法</B><BR>
　代入先への代入方法です、次の4種類があります。ここでは、代入先を「左辺」、代入する文字列を「右辺」と呼ぶことにします。<BR>
<BR>
　「<B>＝</B>」 … 左辺に右辺をそのまま代入します。<BR>
　「<B>＋＝</B>」 … 左辺の文字列変数に右辺を追加します。<BR>
　「<B>上1行コピー</B>」 … 右辺の上1行だけ左辺に代入します。<BR>
　「<B>上1行切り取り</B>」 … 右辺の上1行を切り取り、左辺に代入します。つまり、この処理を行うと右辺の上1行が消去されます。<BR>
　「<B>に↓から1文字切り出し</B>」 … 右辺の先頭1文字を切り取り、左辺に代入します。この処理を行うと右辺の先頭1文字が消去されます。全角、半角共に対応しています。<BR>
　特殊文字の場合は特殊で、1回の処理で\A+なら「\A+」、\c[1]なら「\c[1]」分だけ抜き取ることができ、\r[X,A]など文字列が入る特殊文字の場合は「\r[」だけを抜き取ります。<br>　「<B>に↓から最後1文字切り出し</B>」 … 右辺の最後1文字を切り取り、左辺に代入します。この処理を行うと右辺の最後の1文字が消去されます。全角、半角共に対応しています。特殊文字の場合も、「<b>に↓から1文字切り出し</b>」と同様です。<BR>
　「<B>に↓のファイル内容読込</B>」 … 右辺のファイル名のデータを読み込み、左辺の文字列変数に格納します。右辺には、「Data/test.txt」という具合に代入してください。<br>
<span style="color : #999999;">　　※読み込む文字コードを「UTF-8[標準]」「SJIS」「文字コード自動判別」から選択できます。よく分からなければ自動判別にしてください（Ver3.00より）。</span><BR>
　「<B>をファイル↓に出力</B>」 … 左辺の文字列変数の中身を、右辺のファイル名のデータに保存します。<br>
<span style="color : #999999;">　　※保存するフォーマットを「UTF-8/BOM有」と「UTF-8/BOMなし」から選べます。通常は「BOM有」で問題ありません。ウディタ上ではどちらでも読み込めますが、「BOM有」の方が読み込み処理が軽くて安全です。(Ver3.10より)</span><br>
　<span style="color : #999999;">※保存先文字列内に「//」「\\」「..」「./」「.\」「%」「:」「*」「?」「&quot;」「&lt;」「&gt;」「|」が含まれていると保存できませんので注意してください(Ver3.00より)</span><br>　「<B>に↓のファイルをBase64で読込</B>」 … 右辺のファイル名のデータを読み込み、Base64に変換して文字列変数に格納します。<br>
<span style="color : #999999;">　　※<b>Base64</b>：画像など、本来人間がテキスト情報として読めないバイナリデータを「a-z、A-Z、0-9」の64文字のデータに変換します。このBase64形式のデータは、もっぱらオンラインのデータ処理に使われます。</span><BR>
　「<B>に↓フォルダのファイルリスト取得</B>」 … 右辺に指定されたフォルダ内のファイル一覧を取得し、左辺に代入します。格納されるのは1ファイルにつき1行なので、各々のファイル名は「<B>上1行切り出し</B>」などを使用して取得してください。なお、<B>暗号化フォルダ</B>に対しては機能しません（&lt;&lt;ERROR&gt;&gt;が返されます）。<BR>
　「<B>から↓の文字列を全消去</B>」 … 左辺の文字列内から、右辺の文字列だけを全て消去します。（例：左辺が「あいうえお」のとき、「い」を全消去すると、左辺が「あうえお」となります）<br>
　「<B>に↓から特殊文字を消去して格納</B>」 … 左辺の文字列内から、右辺の文字列に含まれる特殊文字を全て消去します。フォント変更の\f[]などの特殊文字によって生まれた内部コードを全て削除します。\r[X,Y]のYY部分や\img[]指定も、「
] 」が終わる範囲まで消去されます。<BR>
　「<B>から以下の文字列を置換</B>」 … 左辺の文字列内から、左側の入力欄に入れられた文字列を右側の入力欄に入れられた文字列で置換します。（例：左辺が「あいうえお」の時、「え」を「お」で置換すると、左辺が「あいうおお」になります。コンマ区切り(CSV)のデータを読み込んだ際に、「,」を改行で置換して、1行切り出しで読み込みなどの用途に使えるかと思われます。）<BR>
　<img src="Ev_string2.png" border="1"><BR>
<BR>
　「<B>&lt;から指定文字まで切り出し&gt;</B>」 … 左辺の文字列内から、入力欄に入れられた文字列までだけ切り出します（例：左辺が「あいうえお」のとき、「う」まで切り出すと左辺が「あい」になります）。指定した文字列が見つからない場合、「<B>&lt;&lt;NotFound&gt;&gt;</B>」を返します。<BR>
　「<B>&lt;から指定文字以降を切り出し&gt;</B>」 … 左辺の文字列内から、入力欄に入れられた文字列以降だけ切り出します（例：左辺が「あいうえお」のとき、「う」以降を切り出すと左辺が「えお」になります）。指定した文字列が見つからない場合、「<B>&lt;&lt;NotFound&gt;&gt;</B>」を返します。<BR>
<BR>
※ファイル入出力や1行、1文字切り出し機能を駆使すれば、キャラデータを他の人と交換したりすることが可能になります！<BR>
<BR>
<BR>
<BR>
<B>３．代入する文字列</B><BR>
　代入する文字列は、次の4種類の方法で指定できます。<BR>
<BR>
・<B>手動入力</B> … 手動で文字を入力します。この入力には\v[?]や\s[?]といった特殊文字も使用可能です。<BR>
<BR>
・<B>文字列変数</B> … 他の文字列変数を読み込みます。<BR>
<BR>
・<B>ロード位置を変数で指定</B> … 「変数の値」の文字列変数を読みに行きます。たとえば読み込んだ変数値の値が3000002（文字列変数2番のコード）という風に格納されていれば、文字列変数2番を読みに行きます。<BR>
<BR>
・<B>キーボード入力</B> … プレイヤーにキーボードからの文字入力をうながします。キャンセル有りにするとEscキーで入力をキャンセルすることができます。なお、この文字入力には日本語も使用可能です。左辺を置換にチェックをすると、左辺に元から入っていた文字列が入力された状態で文字入力をさせることができます。<BR>
<FONT size="-1">　</FONT><FONT color="#ff0000" size="-1">※テストプレイ時に限り、『キーボード入力』中に「F7〜F9キーなどのデバッグメニューを表示する」あるいは「F11キーで再読み込みする」と「<B> キーボード入力中の文字のサイズが変わってしまいます</B> 」が、文字サイズを設定するタイミングは「キーボード入力の開始時」のみなので、<B>この動作自体は仕様です</B>。(2017/3/7追加)</FONT><BR>
<BR>
<BR>
<BR>
<B>４．変数名の設定</B><BR>
　この欄で文字列変数に名前を付けたり、最大数を増やしたりすることができます。設定したい変数をプルダウンリストから選び、設定したい名前を入力したら「<B>設定</B>」ボタンを押してください。<BR>
　「<B>↓コピー</B>」ボタンは、プルダウンリストで選択中の文字列変数の名前を下にコピーします。<BR>　「<B>サイズ+1</B>」ボタンは、文字列変数の最大数を一つ増やします。<BR>
<BR>
<BR>

<HR>
<P id="secret_code"><B><span style="font-size : 120%;">【隠し機能　&lt;&lt;〜〜&gt;&gt;の裏コード入力でパラメータを得たり隠し処理を行う】</span></B><BR>
<BR>
　実はこの文字列操作コマンドには、&lt;&lt;〜&gt;&gt;から始まるコマンドを指定することで何らかのデータ取得処理が行える隠し機能があります。<BR>
　これは「<b>に↓のファイル内容読込</b>」を選んだ場合だけ実行できます。<br>
　（このコマンドはファイル名を指定するため先頭に「&lt;」が来ることはありえないため、1文字目に「&lt;」があれば裏コードだと分かるのです）<BR>
<BR>
<BR>
　<B>【共通した手順】</B><BR>
<BR>
　1.「文字列操作」コマンドで「<B>に↓のファイル内容読込</B>」を選ぶ。<BR>
<BR>
　2.「<B>手動入力</B>」欄を選び、以下のコードを入力してください。<br>
<br>
<br>　<B>【A.<span style="color : #ff0000;">&lt;&lt;GET_SOUNDTIME&gt;&gt;</span><span style="color : #0000ff;">(ファイル名)</span>　→ 音声ファイルの再生時間をミリ秒で得る】</B>　（Ver2.264以降)<BR>
<br>
　3-A. 「<b>手動入力</b>」欄に「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_SOUNDTIME&gt;&gt;</SPAN><SPAN>Data/SE/effect.ogg</SPAN></B>」と指定すると、格納先の「文字列変数」に「<B>Data/SE/effect.ogg</B>」の「<B>再生時間（ミリ秒）</B>」の数字が文字列として格納されます。<BR>
　　たとえばeffect.oggが1.3秒の音なら、「1300」の文字列が格納されます。あとは「変数操作」で「右辺」に「↑で格納した文字列変数」を指定し、数字変数に格納してご利用ください。<BR>
　　<SPAN style="font-size : 80%;">※たとえば「変数操作」コマンドの「右辺」に「1600005」と入れると、「コモンセルフ変数5」に入った文字列を「数字」に変換して処理できます。</SPAN><BR>
<br>
<BR>
　<B>【B.<span style="color : #ff0000;">&lt;&lt;GET_FILE_EXIST&gt;&gt;</span><span style="color : #0000ff;">(ファイル名)</span>　→ ファイルまたはフォルダが存在するか確認する】</B>（Ver2.271以降)<BR>
<BR>
　3-B.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_FILE_EXIST&gt;&gt;</SPAN><SPAN>Data/Graphic/Edy.png</SPAN></B>」と指定します。<BR>
　　実行されると、「<B><SPAN>Data/Graphic/Edy.png</SPAN></B>」が存在すれば格納先の「文字列変数」に「<B>1</B>」が、存在しなければ「<B>0</B>」が文字列として格納されます。<br>
　　このコマンドは<b>フォルダ</b>に対しても1が返されます（ただし、<b>末尾に「/」や「\」が入っていると0が返されます</b>。「<b>Data/Graphic</b>」などと指定してあれば「<b>1</b>」が返ります）。<br>
　　「<b>?</b>」は任意の半角1文字、「<b>*</b>」は任意の文字列として、ワイルドカード指定が可能です。<br>
<br>
<br>
　<B>【C.<span style="color : #ff0000;">&lt;&lt;GET_DIRECTORY_EXIST&gt;&gt;</span><span style="color : #0000ff;">(フォルダ名)</span>　→ フォルダが存在するか確認する】</B> （Ver3.241以降）<BR>
<BR>
　3-C.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_DIRECTORY_EXIST&gt;&gt;</SPAN><SPAN>Data/Graphic</SPAN></B>」と指定します。<BR>
　　実行されると、「<B><SPAN>Data/Graphic</SPAN></B>」が<b>フォルダとして存在していれば</b>格納先の「文字列変数」に「<B>1</B>」が、存在しなければ「<B>0</B>」が文字列として格納されます。<br>
　　このコマンドでファイルを指定した場合は「<b>0</b>」が返るため、「<b>&lt;&lt;GET_FILE_EXIST&gt;&gt;</b>」とうまく使い分けてください。<br>
<br>
<br>
　<B>【D.<span style="color : #ff0000;">&lt;&lt;GET_MAPEVENT_ID_FROM_NAME&gt;&gt;</span><span style="color : #0000ff;">(イベント名)</span>　→ [マップイベント名]からマップイベント番号を得る】</B>（Ver3.00以降）<BR>
<BR>
　3-D.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_MAPEVENT_ID_FROM_NAME&gt;&gt;</SPAN><SPAN>エディ</SPAN></B>」と指定します。<BR>
　　コマンドが実行されると、マップイベントの中に「<B><SPAN>エディ</SPAN></B>」という名前のイベントが存在すれば格納先の「文字列変数」に「<B>そのマップイベントID(同名が複数ある場合は一番大きいID）</B>」が、存在しなければ「<B>-1</B>」が文字列として格納されます。<br>
<br>
<br>
　<B>【E.<span style="color : #ff0000;">&lt;&lt;GET_MAPEVENT_NAME_FROM_ID&gt;&gt;</span><span style="color : #0000ff;">(イベントID)</span>　→ [マップイベントID]からマップイベント名を得る】</B>（Ver3.00以降）<BR>
<BR>
　3-E.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_MAPEVENT_NAME_FROM_ID&gt;&gt;</SPAN><SPAN>7</SPAN></B>」などと指定します。<BR>
　　コマンドが実行されると「<b>該当IDのマップイベント名</b>」（「<B><SPAN>ハカセ</SPAN></B>」など）が返されます。<br>
　　該当IDのマップイベントが存在しない場合は「<B>&lt;&lt;NotFound&gt;&gt;</B>」が文字列として格納されます。<br>
<br>
<br>
　<B>【F.<span style="color : #ff0000;">&lt;&lt;GET_COMMONEVENT_ID_FROM_NAME&gt;&gt;</span><span style="color : #0000ff;">(イベント名)</span>　→ [コモンイベント名]からコモンイベント番号を得る】</B>（Ver3.00以降）<BR>
<BR>
　3-F.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_COMMONEVENT_ID_FROM_NAME&gt;&gt;</SPAN><SPAN>▲装備取得</SPAN></B>」などと指定します。<BR>
　　コマンドが実行されると、コモンイベントの中に「<B><SPAN>▲装備取得</SPAN></B>」という名前のイベントが存在すれば格納先の「文字列変数」に「<B>21</B>」など<B>「そのコモンイベントID (同名が複数ある場合は一番大きいID）</B>」が、存在しなければ「<B>-1</B>」が文字列として格納されます。<br>
<br>
<br>
<br>
　<B>【G.<span style="color : #ff0000;">&lt;&lt;GET_MAPEV_FILENAME&gt;&gt;</span><span style="color : #0000ff;">(イベントID)</span> → [マップイベントID]からマップイベントの画像ファイル名を得る】</B>（Ver3.00以降）<BR>
<BR>
　3-G.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_MAPEV_FILENAME&gt;&gt;</SPAN><SPAN>7</SPAN></B>」など指定します。<BR>
　　コマンドが実行されると、「<b>マップID12番の今のキャラチップの画像ファイル</b>(CharaChip/[Chara]Doctor.pngなど)」が返されます。<br>
　　そのIDのイベントがなければ「<b>&lt;&lt;NotFound&gt;&gt;</b>」が返されます。<br>
　　現在表示されているのがタイル画像なら「<b>&lt;TILE&gt;15</b>」(タイル15番)のように格納されます。<br>
<br>
<br>
　<B>【H.<span style="color : #ff0000;">&lt;&lt;GET_TILE_FILENAME&gt;&gt;</span><span style="color : #0000ff;">(タイルセット番号)</span> → [タイル番号の数値]番のタイルファイル名を得る】</B>（Ver3.00以降）<BR>
<BR>
　3-H.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_TILE_FILENAME&gt;&gt;</SPAN><SPAN>1</SPAN></B>」など指定すると、現在マップの<b>「オートタイル1番のタイル画像ファイル名</b>(MapChip/[A]WaterFall2_pipo.pngなど)<b>」</b>が取得できます。<br>
　　番号指定は、0なら基本タイル画像、1〜31がオートタイル画像です。<br>
<br>
<br>
　<B>【I.<span style="color : #ff0000;">&lt;&lt;GET_FILENAME_FROM_PICTURE&gt;&gt;</span><span style="color : #0000ff;">(ピクチャIDの数値)</span> → ピクチャの画像ファイル名を得る】</B>（Ver3.00以降）<BR>
<BR>
　3-I.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_FILENAME_FROM_PICTURE&gt;&gt;</SPAN><SPAN>10001</SPAN></B>」など指定すると、「<b>ピクチャID10001番に読み込まれた画像ファイル名</b>(「SystemFile/WindowBase_amania.pngなど)」が取得できます。<br>
　　もしそれが文字列ピクチャなら、ピクチャに指定された「<b>文字列</b>」を返します。<br>
<br>
<br>
　<B>【J.<span style="color : #ff0000;">&lt;&lt;GET_STRING_WIDTH_COUNT&gt;&gt;</span><span style="color : #0000ff;">(文字列)</span> → 文字列の長さを半角1、全角2換算で得る】</B>（Ver3.00以降）<BR>
<BR>
　3-J.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;GET_STRING_WIDTH_COUNT&gt;&gt;</SPAN><SPAN>あああAAAA</SPAN></B>」などと指定すると、[全角2×3]＋[半角1×4]で「<b>10</b>（文字列の長さ）」が取得できます。<br>
　　改行や特殊文字はカウントしません（ただし「\\」（半角￥マーク）は1とカウントします）。<br>
<BR>
<br>
　<B>【K.<span style="color : #ff0000;">&lt;&lt;CUT_STRING_WIDTH_COUNT=</span><span style="color : #0000ff;">(数値)</span><span style="color : #ff0000;">&gt;&gt;</span><span style="color : #0000ff;">(文字列)</span> → (数値)の横幅分で文字列をカットして得る (横幅は半角文字で1、全角文字で2)】</B>（Ver3.23以降）<BR>
<BR>
　3-K.「<B>手動入力</B>」欄を選び、「<B><SPAN style="color : #ff0000;">&lt;&lt;CUT_STRING_WIDTH_COUNT=8&gt;&gt;</SPAN><SPAN>あああAいAAA</SPAN></B>」などと指定すると、「<b>あああA</b>」が取得できます。(<b>あああA</b>=横幅「7」分。まだ半角1文字だけ入りますが、次の「い」を入れると横幅「9」になってあふれるので「い」は入りません）<br>
　　特殊文字や改行はカウントしませんが、「\\」（半角￥マーク）は1とカウントします。<br>
　「UTF-8」化で「キーボード入力文字列」のバイト数が調節しにくくなったため、入力された文字列を適切な長さに切り取る目的で搭載されました。<br>
<BR>

<HR>
<p><b>【隠し機能　自動キー入力でEnterを入れて「キーボード入力」を強制決定する】</b></p>
<p>　この「文字列操作」の「キーボード入力」中、並列イベントなどで「キー入力」コマンドの「自動キー入力」を使って「Enter（キーコード：128）」を入力すると、そこまで入力した分でキーボード入力が決定されます。<br>
　時間制限付きの文字入力イベントなどに使えるでしょう、。<br>
</p>
<HR>
<P><BR>
</P>
<P><BR>
</P>
</BODY>
</HTML>